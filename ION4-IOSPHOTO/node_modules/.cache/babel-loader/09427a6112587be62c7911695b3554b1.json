{"ast":null,"code":"import _regeneratorRuntime from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/tm/Documents/CODE/ION/ION4-IOSPHOTO/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { WebPlugin, CapacitorException } from '@capacitor/core';\nimport { CameraSource, CameraDirection } from './definitions';\nexport var CameraWeb = /*#__PURE__*/function (_WebPlugin) {\n  _inherits(CameraWeb, _WebPlugin);\n\n  var _super = _createSuper(CameraWeb);\n\n  function CameraWeb() {\n    _classCallCheck(this, CameraWeb);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(CameraWeb, [{\n    key: \"getPhoto\",\n    value: function () {\n      var _getPhoto = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(options) {\n        var _this = this;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", new Promise( /*#__PURE__*/function () {\n                  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(resolve, reject) {\n                    var actionSheet;\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            if (options.webUseInput || options.source === CameraSource.Photos) {\n                              _this.fileInputExperience(options, resolve);\n                            } else if (options.source === CameraSource.Prompt) {\n                              actionSheet = document.querySelector('pwa-action-sheet');\n\n                              if (!actionSheet) {\n                                actionSheet = document.createElement('pwa-action-sheet');\n                                document.body.appendChild(actionSheet);\n                              }\n\n                              actionSheet.header = options.promptLabelHeader || 'Photo';\n                              actionSheet.cancelable = false;\n                              actionSheet.options = [{\n                                title: options.promptLabelPhoto || 'From Photos'\n                              }, {\n                                title: options.promptLabelPicture || 'Take Picture'\n                              }];\n                              actionSheet.addEventListener('onSelection', /*#__PURE__*/function () {\n                                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n                                  var selection;\n                                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                                    while (1) {\n                                      switch (_context.prev = _context.next) {\n                                        case 0:\n                                          selection = e.detail;\n\n                                          if (selection === 0) {\n                                            _this.fileInputExperience(options, resolve);\n                                          } else {\n                                            _this.cameraExperience(options, resolve, reject);\n                                          }\n\n                                        case 2:\n                                        case \"end\":\n                                          return _context.stop();\n                                      }\n                                    }\n                                  }, _callee);\n                                }));\n\n                                return function (_x4) {\n                                  return _ref2.apply(this, arguments);\n                                };\n                              }());\n                            } else {\n                              _this.cameraExperience(options, resolve, reject);\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n\n                  return function (_x2, _x3) {\n                    return _ref.apply(this, arguments);\n                  };\n                }()));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function getPhoto(_x) {\n        return _getPhoto.apply(this, arguments);\n      }\n\n      return getPhoto;\n    }()\n  }, {\n    key: \"cameraExperience\",\n    value: function () {\n      var _cameraExperience = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(options, resolve, reject) {\n        var _this2 = this;\n\n        var cameraModal;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!customElements.get('pwa-camera-modal')) {\n                  _context5.next = 15;\n                  break;\n                }\n\n                cameraModal = document.createElement('pwa-camera-modal');\n                document.body.appendChild(cameraModal);\n                _context5.prev = 3;\n                _context5.next = 6;\n                return cameraModal.componentOnReady();\n\n              case 6:\n                cameraModal.addEventListener('onPhoto', /*#__PURE__*/function () {\n                  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e) {\n                    var photo;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            photo = e.detail;\n\n                            if (!(photo === null)) {\n                              _context4.next = 5;\n                              break;\n                            }\n\n                            reject(new CapacitorException('User cancelled photos app'));\n                            _context4.next = 14;\n                            break;\n\n                          case 5:\n                            if (!(photo instanceof Error)) {\n                              _context4.next = 9;\n                              break;\n                            }\n\n                            reject(photo);\n                            _context4.next = 14;\n                            break;\n\n                          case 9:\n                            _context4.t0 = resolve;\n                            _context4.next = 12;\n                            return _this2._getCameraPhoto(photo, options);\n\n                          case 12:\n                            _context4.t1 = _context4.sent;\n                            (0, _context4.t0)(_context4.t1);\n\n                          case 14:\n                            cameraModal.dismiss();\n                            document.body.removeChild(cameraModal);\n\n                          case 16:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x8) {\n                    return _ref3.apply(this, arguments);\n                  };\n                }());\n                cameraModal.present();\n                _context5.next = 13;\n                break;\n\n              case 10:\n                _context5.prev = 10;\n                _context5.t0 = _context5[\"catch\"](3);\n                this.fileInputExperience(options, resolve);\n\n              case 13:\n                _context5.next = 17;\n                break;\n\n              case 15:\n                console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                this.fileInputExperience(options, resolve);\n\n              case 17:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[3, 10]]);\n      }));\n\n      function cameraExperience(_x5, _x6, _x7) {\n        return _cameraExperience.apply(this, arguments);\n      }\n\n      return cameraExperience;\n    }()\n  }, {\n    key: \"fileInputExperience\",\n    value: function fileInputExperience(options, resolve) {\n      var input = document.querySelector('#_capacitor-camera-input');\n\n      var cleanup = function cleanup() {\n        var _a;\n\n        (_a = input.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(input);\n      };\n\n      if (!input) {\n        input = document.createElement('input');\n        input.id = '_capacitor-camera-input';\n        input.type = 'file';\n        input.hidden = true;\n        document.body.appendChild(input);\n        input.addEventListener('change', function (_e) {\n          var file = input.files[0];\n          var format = 'jpeg';\n\n          if (file.type === 'image/png') {\n            format = 'png';\n          } else if (file.type === 'image/gif') {\n            format = 'gif';\n          }\n\n          if (options.resultType === 'dataUrl' || options.resultType === 'base64') {\n            var reader = new FileReader();\n            reader.addEventListener('load', function () {\n              if (options.resultType === 'dataUrl') {\n                resolve({\n                  dataUrl: reader.result,\n                  format: format\n                });\n              } else if (options.resultType === 'base64') {\n                var b64 = reader.result.split(',')[1];\n                resolve({\n                  base64String: b64,\n                  format: format\n                });\n              }\n\n              cleanup();\n            });\n            reader.readAsDataURL(file);\n          } else {\n            resolve({\n              webPath: URL.createObjectURL(file),\n              format: format\n            });\n            cleanup();\n          }\n        });\n      }\n\n      input.accept = 'image/*';\n      input.capture = true;\n\n      if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n        input.removeAttribute('capture');\n      } else if (options.direction === CameraDirection.Front) {\n        input.capture = 'user';\n      } else if (options.direction === CameraDirection.Rear) {\n        input.capture = 'environment';\n      }\n\n      input.click();\n    }\n  }, {\n    key: \"_getCameraPhoto\",\n    value: function _getCameraPhoto(photo, options) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        var format = photo.type.split('/')[1];\n\n        if (options.resultType === 'uri') {\n          resolve({\n            webPath: URL.createObjectURL(photo),\n            format: format\n          });\n        } else {\n          reader.readAsDataURL(photo);\n\n          reader.onloadend = function () {\n            var r = reader.result;\n\n            if (options.resultType === 'dataUrl') {\n              resolve({\n                dataUrl: r,\n                format: format\n              });\n            } else {\n              resolve({\n                base64String: r.split(',')[1],\n                format: format\n              });\n            }\n          };\n\n          reader.onerror = function (e) {\n            reject(e);\n          };\n        }\n      });\n    }\n  }, {\n    key: \"checkPermissions\",\n    value: function () {\n      var _checkPermissions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var permission;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(typeof navigator === 'undefined' || !navigator.permissions)) {\n                  _context6.next = 2;\n                  break;\n                }\n\n                throw this.unavailable('Permissions API not available in this browser');\n\n              case 2:\n                _context6.prev = 2;\n                _context6.next = 5;\n                return window.navigator.permissions.query({\n                  name: 'camera'\n                });\n\n              case 5:\n                permission = _context6.sent;\n                return _context6.abrupt(\"return\", {\n                  camera: permission.state,\n                  photos: 'granted'\n                });\n\n              case 9:\n                _context6.prev = 9;\n                _context6.t0 = _context6[\"catch\"](2);\n                throw this.unavailable('Camera permissions are not available in this browser');\n\n              case 12:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[2, 9]]);\n      }));\n\n      function checkPermissions() {\n        return _checkPermissions.apply(this, arguments);\n      }\n\n      return checkPermissions;\n    }()\n  }, {\n    key: \"requestPermissions\",\n    value: function () {\n      var _requestPermissions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                throw this.unimplemented('Not implemented on web.');\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function requestPermissions() {\n        return _requestPermissions.apply(this, arguments);\n      }\n\n      return requestPermissions;\n    }()\n  }]);\n\n  return CameraWeb;\n}(WebPlugin);\nvar Camera = new CameraWeb();\nexport { Camera };","map":{"version":3,"sources":["../../src/web.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { WebPlugin, CapacitorException } from '@capacitor/core';\nimport { CameraSource, CameraDirection } from './definitions';\nexport class CameraWeb extends WebPlugin {\n    async getPhoto(options) {\n        // eslint-disable-next-line no-async-promise-executor\n        return new Promise(async (resolve, reject) => {\n            if (options.webUseInput || options.source === CameraSource.Photos) {\n                this.fileInputExperience(options, resolve);\n            }\n            else if (options.source === CameraSource.Prompt) {\n                let actionSheet = document.querySelector('pwa-action-sheet');\n                if (!actionSheet) {\n                    actionSheet = document.createElement('pwa-action-sheet');\n                    document.body.appendChild(actionSheet);\n                }\n                actionSheet.header = options.promptLabelHeader || 'Photo';\n                actionSheet.cancelable = false;\n                actionSheet.options = [\n                    { title: options.promptLabelPhoto || 'From Photos' },\n                    { title: options.promptLabelPicture || 'Take Picture' },\n                ];\n                actionSheet.addEventListener('onSelection', async (e) => {\n                    const selection = e.detail;\n                    if (selection === 0) {\n                        this.fileInputExperience(options, resolve);\n                    }\n                    else {\n                        this.cameraExperience(options, resolve, reject);\n                    }\n                });\n            }\n            else {\n                this.cameraExperience(options, resolve, reject);\n            }\n        });\n    }\n    async cameraExperience(options, resolve, reject) {\n        if (customElements.get('pwa-camera-modal')) {\n            const cameraModal = document.createElement('pwa-camera-modal');\n            document.body.appendChild(cameraModal);\n            try {\n                await cameraModal.componentOnReady();\n                cameraModal.addEventListener('onPhoto', async (e) => {\n                    const photo = e.detail;\n                    if (photo === null) {\n                        reject(new CapacitorException('User cancelled photos app'));\n                    }\n                    else if (photo instanceof Error) {\n                        reject(photo);\n                    }\n                    else {\n                        resolve(await this._getCameraPhoto(photo, options));\n                    }\n                    cameraModal.dismiss();\n                    document.body.removeChild(cameraModal);\n                });\n                cameraModal.present();\n            }\n            catch (e) {\n                this.fileInputExperience(options, resolve);\n            }\n        }\n        else {\n            console.error(`Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.`);\n            this.fileInputExperience(options, resolve);\n        }\n    }\n    fileInputExperience(options, resolve) {\n        let input = document.querySelector('#_capacitor-camera-input');\n        const cleanup = () => {\n            var _a;\n            (_a = input.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(input);\n        };\n        if (!input) {\n            input = document.createElement('input');\n            input.id = '_capacitor-camera-input';\n            input.type = 'file';\n            input.hidden = true;\n            document.body.appendChild(input);\n            input.addEventListener('change', (_e) => {\n                const file = input.files[0];\n                let format = 'jpeg';\n                if (file.type === 'image/png') {\n                    format = 'png';\n                }\n                else if (file.type === 'image/gif') {\n                    format = 'gif';\n                }\n                if (options.resultType === 'dataUrl' ||\n                    options.resultType === 'base64') {\n                    const reader = new FileReader();\n                    reader.addEventListener('load', () => {\n                        if (options.resultType === 'dataUrl') {\n                            resolve({\n                                dataUrl: reader.result,\n                                format,\n                            });\n                        }\n                        else if (options.resultType === 'base64') {\n                            const b64 = reader.result.split(',')[1];\n                            resolve({\n                                base64String: b64,\n                                format,\n                            });\n                        }\n                        cleanup();\n                    });\n                    reader.readAsDataURL(file);\n                }\n                else {\n                    resolve({\n                        webPath: URL.createObjectURL(file),\n                        format: format,\n                    });\n                    cleanup();\n                }\n            });\n        }\n        input.accept = 'image/*';\n        input.capture = true;\n        if (options.source === CameraSource.Photos ||\n            options.source === CameraSource.Prompt) {\n            input.removeAttribute('capture');\n        }\n        else if (options.direction === CameraDirection.Front) {\n            input.capture = 'user';\n        }\n        else if (options.direction === CameraDirection.Rear) {\n            input.capture = 'environment';\n        }\n        input.click();\n    }\n    _getCameraPhoto(photo, options) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            const format = photo.type.split('/')[1];\n            if (options.resultType === 'uri') {\n                resolve({\n                    webPath: URL.createObjectURL(photo),\n                    format: format,\n                });\n            }\n            else {\n                reader.readAsDataURL(photo);\n                reader.onloadend = () => {\n                    const r = reader.result;\n                    if (options.resultType === 'dataUrl') {\n                        resolve({\n                            dataUrl: r,\n                            format: format,\n                        });\n                    }\n                    else {\n                        resolve({\n                            base64String: r.split(',')[1],\n                            format: format,\n                        });\n                    }\n                };\n                reader.onerror = e => {\n                    reject(e);\n                };\n            }\n        });\n    }\n    async checkPermissions() {\n        if (typeof navigator === 'undefined' || !navigator.permissions) {\n            throw this.unavailable('Permissions API not available in this browser');\n        }\n        try {\n            // https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query\n            // the specific permissions that are supported varies among browsers that implement the\n            // permissions API, so we need a try/catch in case 'camera' is invalid\n            const permission = await window.navigator.permissions.query({\n                name: 'camera',\n            });\n            return {\n                camera: permission.state,\n                photos: 'granted',\n            };\n        }\n        catch (_a) {\n            throw this.unavailable('Camera permissions are not available in this browser');\n        }\n    }\n    async requestPermissions() {\n        throw this.unimplemented('Not implemented on web.');\n    }\n}\nconst Camera = new CameraWeb();\nexport { Camera };\n//# sourceMappingURL=web.js.map"]},"metadata":{},"sourceType":"module"}